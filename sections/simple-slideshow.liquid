{% comment %}
  Simple Slideshow section
  - Reuses theme slideshow snippet + slideshow-slide snippet for consistent behaviour
  - Blocks: image + optional caption + optional link
{% endcomment %}

{{ 'simple-slideshow.css' | asset_url | stylesheet_tag }}
<script src="{{ 'simple-slideshow.js' | asset_url }}" type="module" defer></script>

{%- capture slides -%}
  {% for block in section.blocks %}
    {%- capture children -%}
      <div class="simple-slideshow__media">
        {% if block.settings.image %}
          {{
            block.settings.image
            | image_url: width: 2000
            | image_tag:
              loading: 'lazy',
              class: 'simple-slideshow__image',
              alt: block.settings.image_alt
          }}
        {% endif %}
      </div>

      {% if block.settings.caption != blank %}
        <div class="simple-slideshow__caption">
          <div class="simple-slideshow__caption-inner">
            {{ block.settings.caption }}
            {% if block.settings.link != blank %}
              <a class="simple-slideshow__caption-link" href="{{ block.settings.link }}">{{ block.settings.link_label | default: 'Shop' }}</a>
            {% endif %}
          </div>
        </div>
      {% endif %}
    {%- endcapture -%}

    {% render 'slideshow-slide',
      index: forloop.index0,
      children: children,
      slide_size: section.settings.slide_height
    %}
  {% endfor %}
{%- endcapture -%}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<div class="section simple-slideshow-section section--{{ section.settings.section_width }} color-{{ section.settings.color_scheme }}">
  {% render 'slideshow',
    slides: slides,
    slide_count: section.blocks.size,
    class: 'simple-slideshow',
    controls: (section.blocks.size > 1) and (section.settings.show_controls) | default: '',
    autoplay: section.settings.autoplay,
    autoplay_speed: section.settings.autoplay_speed
  %}
</div>

{% schema %}
{
  "name": "Simple Slideshow",
  "settings": [
    {
      "type": "select",
      "id": "section_width",
      "label": "Width",
      "options": [
        { "value": "page-width", "label": "Page width" },
        { "value": "full-width", "label": "Full width" }
      ],
      "default": "page-width"
    },
    {
      "type": "select",
      "id": "slide_height",
      "label": "Slide height",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" }
      ],
      "default": "medium"
    },
    {
      "type": "checkbox",
      "id": "show_controls",
      "label": "Show controls",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Autoplay speed (seconds)",
      "min": 3,
      "max": 20,
      "step": 1,
      "unit": "s",
      "default": 6
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "text", "id": "image_alt", "label": "Alt text (optional)" },
        { "type": "richtext", "id": "caption", "label": "Caption (optional)" },
        { "type": "url", "id": "link", "label": "Link (optional)" },
        { "type": "text", "id": "link_label", "label": "Link label", "default": "Shop" }
      ]
    }
  ],
  "max_blocks": 12,
  "presets": [
    {
      "name": "Simple Slideshow",
      "category": "Media",
      "blocks": [ { "type": "slide" }, { "type": "slide" } ]
    }
  ]
}
{% endschema %}